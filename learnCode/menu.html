<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>You Ready Brahv?</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <canvas id="canvas" style="visibility: hidden;"></canvas>
    <div id="startMenu">
        <p class="start">Welcome To Cyber Dungeon!1!!!1!</p>
        <div class="start" id="startButton">
            <p class="start" id="p">Start</p>
        </div>
    </div>
    <div id="pauseMenu" style="visibility: hidden;">
        <p class="start">Paused</p>
        <div class="start" id="pauseButton" display>
            <p class="start" id="p">Resume</p>
        </div>
    </div>
    <div id="deathMenu" style="visibility: hidden;">
        <p class="start">Rat Got You</p>
        <div class="start" id="deathButton" display>
            <p class="start" id="p">Restart</p>
        </div>
    </div>

    <div id="craftMenu">
        <p>Unique Enemies</br>rats</p>
        <p>Write your code in the text area below and press 'k' to execute it</p>
        <textarea id="code"></textarea>
        <p id="craft">Things You Should Know</br></br>
            To open the console, right click and click inspect, then click console</br>
            You can also use the up and down arrow keys to go back to the previously typed command</br></br>
        </p>
        <h2>Basic code:</h2>
        <p id="craft">
            Important variables/ arrays/ objects necessary to play the game can be viewed in console, with their values,
            by typing their names:</br>
            player, world, world.enemies.</br>
            Try changing the enemies speed for example (world.enemySpeed). This will take a round to apply because the enemies
            are created and have another value set to global enemy speed.</br></br>
            To change the value of a variable, type the name of the variable, an equal sign, and the new value:</br>
            splice(#, #) is specifically for arrays(variable containing multiple items) and deleting their
            values</br></br>
            world is the name of the object, it has the wave, enemySpeed, and enemies</br></br>
            enemies is the array that holds all the enemies, to define one use world.enemies[0] or world.enemies[1] or
            [2] etc</br></br>
            By using splice you can delete one or multiple enemies at once</br>
            splice(0, 1) will delete the first enemy in the array, splice(0, 2) will delete the first and second, and so
            on</br></br>
            splice(1, 1) will delete the second, splice(1, 2) will delete the second and third and so on</br></br>
            A for loop can be used to define how many of something is in an array or such</br>
            console.log() will print the value of the variable in the console</br></br>
            for (i in world.enemies) {console.log(world.enemies[i])}</br>
            i will be replaced with a number representing the item it is iterating, starting from 0</br></br>
        </p>
    </div>

</body>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let paused;

    // Menu when you open the game
    document.getElementById('startButton').addEventListener('click', function () {
        document.getElementById('startMenu').style.display = 'none';
        document.getElementById('startMenu').style.visibility = 'hidden';
        paused = false;
        canvas.style.visibility = 'visible';
        animate()
    });

    document.getElementById('pauseButton').addEventListener('click', function () {
        document.getElementById('pauseMenu').style.visibility = 'hidden';
        document.getElementById('craftMenu').style.animation = "slideIn 1s forwards";
        paused = false;
        animate()
    });

    document.getElementById('deathButton').addEventListener('click', function () {
        document.getElementById('deathMenu').style.visibility = 'hidden';
        paused = false;
        player.x = 500;
        player.y = 500;
        player.speed = 5;
        player.death = false;
        world.wave = 5;
        world.enemies = [];
        animate()
    });

    let world = {};

    world.wave = 5;
    world.enemySpeed = 3;
    world.enemies = [];

    let enemy = function (x, y, width, height, color, speed, health, name) {
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.speed = world.enemySpeed;
        this.health = health;
        this.name = name;
    }



    // Your player
    let player = {}

    player.x = 500;
    player.y = 500;
    player.width = 50;
    player.height = 50;
    player.color = 'red';
    player.speed = 5;
    player.death = false;

    let w = false;
    let a = false;
    let s = false;
    let d = false;

    // read keys being pressed and released
    document.addEventListener('keydown', function () {
        if (event.key == 'w' || event.key == 'W') {
            w = true;
        } if (event.key == 'a' || event.key == 'A') {
            a = true;
        } if (event.key == 's' || event.key == 'S') {
            s = true;
        } if (event.key == 'd' || event.key == 'D') {
            d = true;
        }

    });
    document.addEventListener('keyup', function () {
        if (event.key == 'w' || event.key == 'W') {
            w = false;
        } if (event.key == 'a' || event.key == 'A') {
            a = false;
        } if (event.key == 's' || event.key == 'S') {
            s = false;
        } if (event.key == 'd' || event.key == 'D') {
            d = false;
        } if (event.key == 'k' || event.key == 'K') {
            eval(document.getElementById('code').value);
        }
        if ((event.key == 'p' || event.key == 'P' || event.key == 'Escape') && paused == false && player.death == false) {
            if (document.getElementById('pauseMenu').style.visibility = 'hidden') {
                document.getElementById('pauseMenu').style.visibility = 'visible';
                document.getElementById('craftMenu').style.animation = "slideOut 1s forwards";
                paused = true;
            } else {
                document.getElementById('pauseMenu').style.visibility = 'hidden';
                document.getElementById('craftMenu').style.animation = "slideIn 1s forwards";
                paused = false;
                animate
            }
        }
    });

    ctx.canvas.width = 2000;
    ctx.canvas.height = 2000;

    let bg = new Image();
    bg.src = 'public/floorTile.PNG';
    let jermaRat = new Image();
    jermaRat.src = 'public/jermaRat.png';
    let jermaRatR = new Image();
    jermaRatR.src = 'public/jermaRatR.png';
    let jerma = new Image();
    jerma.src = 'public/jermaStare.png';

    function animate() {
        // Your animation code goes here
        for (let i = 2000 / 400, j = 0; i > 0; i--, j += 399) {
            for (let k = 2000 / 400, l = 0; k > 0; k--, l += 398) {
                ctx.drawImage(bg, j, l, 400, 400);
            }
        }

        if (world.enemies.length == 0) {
            world.wave++;
            player.health += 10;
            for (let i = 0; i < world.wave; i++) {
                // Calculate the random position within a radius around the player
                let radius = 500; // Adjust the radius as needed
                let randomAngle = Math.random() * 2 * Math.PI;
                let randomDistance = Math.random() * radius + 500;
                let enemyX = player.x + Math.cos(randomAngle) * randomDistance;
                let enemyY = player.y + Math.sin(randomAngle) * randomDistance;

                world.enemies.push(new enemy(enemyX, enemyY, 80, 50, 'blue', world.enemySpeed, 100, "rat"));
            }
        } else {
            for (let i = 0; i < world.enemies.length; i++) {
                // Calculate the distance between the enemy and the player
                let distanceX = player.x - world.enemies[i].x;
                let distanceY = player.y - world.enemies[i].y;

                // Calculate the angle between the enemy and the player
                let angle = Math.atan2(distanceY, distanceX);

                // Calculate the velocity of the enemy
                let velocityX = Math.cos(angle) * world.enemies[i].speed;
                let velocityY = Math.sin(angle) * world.enemies[i].speed;

                // Update the position of the enemy
                world.enemies[i].x += velocityX;
                world.enemies[i].y += velocityY;

                if (world.enemies[i].x < player.x + player.width &&
                    world.enemies[i].x + world.enemies[i].width > player.x &&
                    world.enemies[i].y < player.y + player.height &&
                    world.enemies[i].y + world.enemies[i].height > player.y) {
                    world.enemies.splice(i, 1);
                    player.death = true;
                }

                if (player.death == true) {
                    paused = true;
                    document.getElementById('deathMenu').style.visibility = 'visible';
                }


                // Draw the enemy on the canvas
                if (world.enemies[i].x < player.x) {
                    ctx.drawImage(jermaRatR, world.enemies[i].x, world.enemies[i].y, world.enemies[i].width, world.enemies[i].height);
                } else {
                    ctx.drawImage(jermaRat, world.enemies[i].x, world.enemies[i].y, world.enemies[i].width, world.enemies[i].height);
                }

                // Push enemies away from each other
                for (let j = 0; j < world.enemies.length; j++) {
                    if (i !== j) {
                        let distanceX = world.enemies[j].x - world.enemies[i].x;
                        let distanceY = world.enemies[j].y - world.enemies[i].y;
                        let distance = Math.sqrt(distanceX * distanceX + distanceY * distanceY);

                        if (distance < 50) {
                            let pushForce = .2;
                            let pushX = (distanceX / distance) * pushForce;
                            let pushY = (distanceY / distance) * pushForce;

                            world.enemies[i].x -= pushX;
                            world.enemies[i].y -= pushY;
                            world.enemies[j].x += pushX;
                            world.enemies[j].y += pushY;


                        }
                    }
                }

                if (world.enemies[i].x < player.x + player.width &&
                    world.enemies[i].x + world.enemies[i].width > player.x &&
                    world.enemies[i].y < player.y + player.height &&
                    world.enemies[i].y + world.enemies[i].height > player.y) {
                    world.enemies.splice(i, 1);
                    player.death = true;
                }


            }
        }

        if (player.death == true) {
            paused = true;
            document.getElementById('deathMenu').style.visibility = 'visible';
        }

        if (w) {
            player.y -= player.speed;
        }
        if (a) {
            player.x -= player.speed;
        }
        if (s) {
            player.y += player.speed;
        }
        if (d) {
            player.x += player.speed;
        }
        scrollTo(player.x - window.innerWidth / 2, player.y - window.innerHeight / 2);
        ctx.fillStyle = player.color;
        ctx.drawImage(jerma, player.x - 20, player.y - 20, 80, 80);

        if (paused == false) {
            requestAnimationFrame(animate);
        }
    }

    animate();

</script>

</html>